<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>pm2文档 | central park</title>
    <meta name="generator" content="VuePress 1.5.4">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="Just front-end docs">
    <link rel="preload" href="/assets/css/0.styles.ccac5a78.css" as="style"><link rel="preload" href="/assets/js/app.fb2b0e5f.js" as="script"><link rel="preload" href="/assets/js/2.4a6e408c.js" as="script"><link rel="preload" href="/assets/js/31.72cca3f5.js" as="script"><link rel="prefetch" href="/assets/js/10.9881f3e6.js"><link rel="prefetch" href="/assets/js/11.e6263b2d.js"><link rel="prefetch" href="/assets/js/12.3dd111bd.js"><link rel="prefetch" href="/assets/js/13.1dbe2336.js"><link rel="prefetch" href="/assets/js/14.e277a8ee.js"><link rel="prefetch" href="/assets/js/15.bcd5911c.js"><link rel="prefetch" href="/assets/js/16.a56af9eb.js"><link rel="prefetch" href="/assets/js/17.7e5b8f5a.js"><link rel="prefetch" href="/assets/js/18.64823cf1.js"><link rel="prefetch" href="/assets/js/19.edbfdfb0.js"><link rel="prefetch" href="/assets/js/20.468c4e8d.js"><link rel="prefetch" href="/assets/js/21.b9a24f03.js"><link rel="prefetch" href="/assets/js/22.74d9919a.js"><link rel="prefetch" href="/assets/js/23.3765d2d4.js"><link rel="prefetch" href="/assets/js/24.987146f3.js"><link rel="prefetch" href="/assets/js/25.1456b78e.js"><link rel="prefetch" href="/assets/js/26.3e2a8325.js"><link rel="prefetch" href="/assets/js/27.add26a51.js"><link rel="prefetch" href="/assets/js/28.9d5ba05f.js"><link rel="prefetch" href="/assets/js/29.8d60d6a8.js"><link rel="prefetch" href="/assets/js/3.a99730d9.js"><link rel="prefetch" href="/assets/js/30.19811446.js"><link rel="prefetch" href="/assets/js/32.a5cb5e82.js"><link rel="prefetch" href="/assets/js/33.4f59465f.js"><link rel="prefetch" href="/assets/js/34.d124cc8f.js"><link rel="prefetch" href="/assets/js/35.5cd9336a.js"><link rel="prefetch" href="/assets/js/36.78918402.js"><link rel="prefetch" href="/assets/js/37.2ce5af46.js"><link rel="prefetch" href="/assets/js/38.eca13021.js"><link rel="prefetch" href="/assets/js/39.fb8bbc2a.js"><link rel="prefetch" href="/assets/js/4.a5e1eadb.js"><link rel="prefetch" href="/assets/js/40.9cc6227d.js"><link rel="prefetch" href="/assets/js/41.8f6783a6.js"><link rel="prefetch" href="/assets/js/42.44e13fe8.js"><link rel="prefetch" href="/assets/js/43.212d8290.js"><link rel="prefetch" href="/assets/js/44.81d199f5.js"><link rel="prefetch" href="/assets/js/45.3791b0e8.js"><link rel="prefetch" href="/assets/js/46.fc6f591a.js"><link rel="prefetch" href="/assets/js/47.8d072f15.js"><link rel="prefetch" href="/assets/js/48.6c5cda3f.js"><link rel="prefetch" href="/assets/js/49.8b370b6f.js"><link rel="prefetch" href="/assets/js/5.9e9ea533.js"><link rel="prefetch" href="/assets/js/50.d8f5c01a.js"><link rel="prefetch" href="/assets/js/51.cc055b69.js"><link rel="prefetch" href="/assets/js/52.8f77dcff.js"><link rel="prefetch" href="/assets/js/53.96f3feb0.js"><link rel="prefetch" href="/assets/js/54.19532d51.js"><link rel="prefetch" href="/assets/js/55.85d0dfb8.js"><link rel="prefetch" href="/assets/js/6.70a4eb21.js"><link rel="prefetch" href="/assets/js/7.e0a3b951.js"><link rel="prefetch" href="/assets/js/8.97277659.js"><link rel="prefetch" href="/assets/js/9.7d7b65a7.js">
    <link rel="stylesheet" href="/assets/css/0.styles.ccac5a78.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="./logo.png" alt="central park" class="logo"> <span class="site-name can-hide">central park</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CSS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Javascript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据结构与算法</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>设计模式</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>网络相关</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>webpack</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>nodejs</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/nodejs/koa和typescript搭建中台.html" class="sidebar-link">koa和typescript搭建中台</a></li><li><a href="/nodejs/nodejs爬取豆瓣读书Top250.html" class="sidebar-link">nodejs爬取豆瓣读书Top250</a></li><li><a href="/nodejs/npm不完全解析.html" class="sidebar-link">npm不完全解析</a></li><li><a href="/nodejs/pm2文档.html" class="active sidebar-link">pm2文档</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/nodejs/pm2文档.html#安装pm2" class="sidebar-link">安装pm2</a></li><li class="sidebar-sub-header"><a href="/nodejs/pm2文档.html#启动进程" class="sidebar-link">启动进程</a></li><li class="sidebar-sub-header"><a href="/nodejs/pm2文档.html#重命名进程" class="sidebar-link">重命名进程</a></li><li class="sidebar-sub-header"><a href="/nodejs/pm2文档.html#监听进程" class="sidebar-link">监听进程</a></li><li class="sidebar-sub-header"><a href="/nodejs/pm2文档.html#结束进程" class="sidebar-link">结束进程</a></li><li class="sidebar-sub-header"><a href="/nodejs/pm2文档.html#结束所有进程" class="sidebar-link">结束所有进程</a></li><li class="sidebar-sub-header"><a href="/nodejs/pm2文档.html#删除进程" class="sidebar-link">删除进程</a></li><li class="sidebar-sub-header"><a href="/nodejs/pm2文档.html#删除所有进程" class="sidebar-link">删除所有进程</a></li><li class="sidebar-sub-header"><a href="/nodejs/pm2文档.html#列出所有进程" class="sidebar-link">列出所有进程</a></li><li class="sidebar-sub-header"><a href="/nodejs/pm2文档.html#查看某个进程详情" class="sidebar-link">查看某个进程详情</a></li><li class="sidebar-sub-header"><a href="/nodejs/pm2文档.html#重启单个进程" class="sidebar-link">重启单个进程</a></li><li class="sidebar-sub-header"><a href="/nodejs/pm2文档.html#重启所有进程" class="sidebar-link">重启所有进程</a></li><li class="sidebar-sub-header"><a href="/nodejs/pm2文档.html#查看单个进程日志" class="sidebar-link">查看单个进程日志</a></li><li class="sidebar-sub-header"><a href="/nodejs/pm2文档.html#查看所有进程日志" class="sidebar-link">查看所有进程日志</a></li><li class="sidebar-sub-header"><a href="/nodejs/pm2文档.html#查看当前通过-pm2-运行的进程的状态" class="sidebar-link">查看当前通过 pm2 运行的进程的状态</a></li><li class="sidebar-sub-header"><a href="/nodejs/pm2文档.html#根据文件启动服务" class="sidebar-link">根据文件启动服务</a></li><li class="sidebar-sub-header"><a href="/nodejs/pm2文档.html#pm2-logrotate" class="sidebar-link">pm2-logrotate</a></li><li class="sidebar-sub-header"><a href="/nodejs/pm2文档.html#使用方法" class="sidebar-link">使用方法</a></li><li class="sidebar-sub-header"><a href="/nodejs/pm2文档.html#参数" class="sidebar-link">参数</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>需求和缺陷</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="pm2文档"><a href="#pm2文档" class="header-anchor">#</a> pm2文档</h1> <p>pm2是一个进程管理工具，可以利用它来简化很多 node 应用管理的繁琐任务，如性能监控、自动重启、负载均衡等。</p> <h2 id="安装pm2"><a href="#安装pm2" class="header-anchor">#</a> 安装pm2</h2> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> pm2 -D
</code></pre></div><h2 id="启动进程"><a href="#启动进程" class="header-anchor">#</a> 启动进程</h2> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># app.js是入口文件 进程名为文件名app</span>
pm2 start app.js 
</code></pre></div><h2 id="重命名进程"><a href="#重命名进程" class="header-anchor">#</a> 重命名进程</h2> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 进程名server</span>
pm2 start app.js --name server
</code></pre></div><h2 id="监听进程"><a href="#监听进程" class="header-anchor">#</a> 监听进程</h2> <p>监听应用目录的变化，一旦发生变化，自动重启。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>pm2 start app.js --watch
</code></pre></div><h2 id="结束进程"><a href="#结束进程" class="header-anchor">#</a> 结束进程</h2> <div class="language-bash extra-class"><pre class="language-bash"><code>pm2 stop app
</code></pre></div><h2 id="结束所有进程"><a href="#结束所有进程" class="header-anchor">#</a> 结束所有进程</h2> <div class="language-bash extra-class"><pre class="language-bash"><code>pm2 stop all
</code></pre></div><h2 id="删除进程"><a href="#删除进程" class="header-anchor">#</a> 删除进程</h2> <div class="language-bash extra-class"><pre class="language-bash"><code>pm2 delete app
</code></pre></div><h2 id="删除所有进程"><a href="#删除所有进程" class="header-anchor">#</a> 删除所有进程</h2> <div class="language-bash extra-class"><pre class="language-bash"><code>pm2 delete all
</code></pre></div><h2 id="列出所有进程"><a href="#列出所有进程" class="header-anchor">#</a> 列出所有进程</h2> <div class="language-bash extra-class"><pre class="language-bash"><code>pm2 list
</code></pre></div><h2 id="查看某个进程详情"><a href="#查看某个进程详情" class="header-anchor">#</a> 查看某个进程详情</h2> <div class="language-js extra-class"><pre class="language-js"><code>pm2 describe app
</code></pre></div><h2 id="重启单个进程"><a href="#重启单个进程" class="header-anchor">#</a> 重启单个进程</h2> <div class="language-bash extra-class"><pre class="language-bash"><code>pm2 restart app
</code></pre></div><h2 id="重启所有进程"><a href="#重启所有进程" class="header-anchor">#</a> 重启所有进程</h2> <div class="language-bash extra-class"><pre class="language-bash"><code>pm2 restart all
</code></pre></div><h2 id="查看单个进程日志"><a href="#查看单个进程日志" class="header-anchor">#</a> 查看单个进程日志</h2> <div class="language-bash extra-class"><pre class="language-bash"><code>pm2 logs app
</code></pre></div><h2 id="查看所有进程日志"><a href="#查看所有进程日志" class="header-anchor">#</a> 查看所有进程日志</h2> <div class="language-bash extra-class"><pre class="language-bash"><code>pm2 logs
</code></pre></div><h2 id="查看当前通过-pm2-运行的进程的状态"><a href="#查看当前通过-pm2-运行的进程的状态" class="header-anchor">#</a> 查看当前通过 pm2 运行的进程的状态</h2> <div class="language-bash extra-class"><pre class="language-bash"><code>pm2 monit
</code></pre></div><h2 id="根据文件启动服务"><a href="#根据文件启动服务" class="header-anchor">#</a> 根据文件启动服务</h2> <p>pm2.json</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
    <span class="token string">&quot;apps&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;app&quot;</span><span class="token punctuation">,</span>       <span class="token comment">// 项目名          </span>
        <span class="token string">&quot;script&quot;</span><span class="token operator">:</span> <span class="token string">&quot;app.js&quot;</span><span class="token punctuation">,</span>              <span class="token comment">// 执行文件</span>
        <span class="token string">&quot;cwd&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./&quot;</span><span class="token punctuation">,</span>                     <span class="token comment">// 根目录</span>
        <span class="token string">&quot;args&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>                      <span class="token comment">// 传递给脚本的参数</span>
        <span class="token string">&quot;interpreter&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>               <span class="token comment">// 指定的脚本解释器</span>
        <span class="token string">&quot;interpreter_args&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>          <span class="token comment">// 传递给解释器的参数</span>
        <span class="token string">&quot;watch&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>                   <span class="token comment">// 是否监听文件变动然后重启</span>
        <span class="token string">&quot;ignore_watch&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>                <span class="token comment">// 不用监听的文件</span>
            <span class="token string">&quot;node_modules&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;public&quot;</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">&quot;exec_mode&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cluster_mode&quot;</span><span class="token punctuation">,</span>     <span class="token comment">// 应用启动模式，支持 fork 和 cluster 模式</span>
        <span class="token string">&quot;instances&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span>              <span class="token comment">// 应用启动实例个数，仅在 cluster 模式有效 默认为 fork max为你设备核数</span>
        <span class="token string">&quot;error_file&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./logs/app-err.log&quot;</span><span class="token punctuation">,</span>         <span class="token comment">// 错误日志文件</span>
        <span class="token string">&quot;out_file&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./logs/app-out.log&quot;</span><span class="token punctuation">,</span>           <span class="token comment">// 正常日志文件</span>
        <span class="token string">&quot;merge_logs&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>                         <span class="token comment">// 设置追加日志而不是新建日志</span>
        <span class="token string">&quot;log_date_format&quot;</span><span class="token operator">:</span> <span class="token string">&quot;YYYY-MM-DD HH:mm:ss&quot;</span><span class="token punctuation">,</span>   <span class="token comment">// 指定日志文件的时间格式</span>
        <span class="token string">&quot;min_uptime&quot;</span><span class="token operator">:</span> <span class="token string">&quot;60s&quot;</span><span class="token punctuation">,</span>                        <span class="token comment">// 应用运行少于时间被认为是异常启动</span>
        <span class="token string">&quot;max_restarts&quot;</span><span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span>                         <span class="token comment">// 最大异常重启次数</span>
        <span class="token string">&quot;autorestart&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>                        <span class="token comment">// 默认为 true, 发生异常的情况下自动重启</span>
        <span class="token string">&quot;restart_delay&quot;</span><span class="token operator">:</span> <span class="token string">&quot;60&quot;</span><span class="token punctuation">,</span>                       <span class="token comment">// 异常重启情况下，延时重启时间</span>
        <span class="token string">&quot;env&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
           <span class="token string">&quot;NODE_ENV&quot;</span><span class="token operator">:</span> <span class="token string">&quot;production&quot;</span><span class="token punctuation">,</span>                <span class="token comment">// 环境参数，当前指定为生产环境</span>
           <span class="token string">&quot;REMOTE_ADDR&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span>               
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">&quot;env_dev&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;NODE_ENV&quot;</span><span class="token operator">:</span> <span class="token string">&quot;development&quot;</span><span class="token punctuation">,</span>              <span class="token comment">// 环境参数，当前指定为开发环境</span>
            <span class="token string">&quot;REMOTE_ADDR&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">&quot;env_test&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>                               <span class="token comment">// 环境参数，当前指定为测试环境</span>
            <span class="token string">&quot;NODE_ENV&quot;</span><span class="token operator">:</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;REMOTE_ADDR&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code>pm2 start pm2.json
</code></pre></div><h2 id="pm2-logrotate"><a href="#pm2-logrotate" class="header-anchor">#</a> pm2-logrotate</h2> <p>这个是用来分割日志的，只能用在pm2上。</p> <h3 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h3> <div class="language-js extra-class"><pre class="language-js"><code>pm2 install pm2<span class="token operator">-</span>logrotate
</code></pre></div><p>注意是 <code>pm2</code> 不是 <code>npm</code></p> <h2 id="使用方法"><a href="#使用方法" class="header-anchor">#</a> 使用方法</h2> <div class="language-js extra-class"><pre class="language-js"><code>pm2 <span class="token keyword">set</span> pm2<span class="token operator">-</span>logrotate<span class="token operator">:</span>max_size <span class="token number">1</span>K
</code></pre></div><h2 id="参数"><a href="#参数" class="header-anchor">#</a> 参数</h2> <p>格式是：pm2 set pm2-logrotate:{paramName} {value}</p> <p>命令设置具体的参数，支持的参数有：</p> <p>| Compress：是否通过gzip压缩日志</p> <p>| max_size：单个日志文件的大小，比如上图中设置为1K（这个其实太小了，实际文件大小并不会严格分为1K）</p> <p>| retain：保留的日志文件个数，比如设置为10,那么在日志文件达到10个后会将最早的日志文件删除掉</p> <p>| dateFormat：日志文件名中的日期格式，默认是YYYY-MM-DD_HH-mm-ss，注意是设置的日志名+这个格式，如设置的日志名为abc.log，那就会生成abc_YYYY-MM-DD_HH-mm-ss.log名字的日志文件</p> <p>| rotateModule：把pm2本身的日志也进行分割</p> <p>| workerInterval：设置启动几个工作进程监控日志尺寸，最小为1</p> <p>| rotateInterval：设置强制分割，默认值是0 0 * * *，意思是每天晚上0点分割，这个足够了个人觉得</p> <p>设置完毕后可通过pm2 conf pm2-logrotate来查看详细的配置。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/nodejs/npm不完全解析.html" class="prev">
        npm不完全解析
      </a></span> <span class="next"><a href="/需求和缺陷/如何实现一个高亮关键字的搜索框.html">
        如何实现一个高亮关键字的搜索框
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.fb2b0e5f.js" defer></script><script src="/assets/js/2.4a6e408c.js" defer></script><script src="/assets/js/31.72cca3f5.js" defer></script>
  </body>
</html>
